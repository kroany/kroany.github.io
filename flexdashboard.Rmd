---
title: "Flexdashboard"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(plotly)
library(p8105.datasets)
```

```{r}
data("instacart")
```


Column {data-width=650}
-----------------------------------------------------------------------

### Chart A

```{r}
instacart |> 
  group_by(department) |> 
  summarize(
    n = n() 
  ) |> 
  arrange(desc(n)) |> 
    mutate(department = fct_reorder(department, n)) |> 
    plot_ly(
    x = ~department, y = ~n, color = ~department,
    type = "bar", colors = "viridis"
  ) |> 
  layout(
    title = "Count of Orders by Department",
    xaxis = list(title = "Department"),
    yaxis = list(title = "Count of Orders")
  )
```

Column {data-width=350}
-----------------------------------------------------------------------

### Chart B

```{r}
instacart |> 
  select(order_id, order_hour_of_day) |> 
  distinct(order_id, .keep_all = TRUE) |> 
  plot_ly(
      x = ~order_hour_of_day,
      type = "histogram", colors = "viridis"
    ) |> 
  layout(
    title = "Histogram of Number of Orders by Hour of Day",
    xaxis = list(title = "Order Hour of Day"),
    yaxis = list(title = "Count of Orders")
  )
```

### Chart C

```{r}
instacart |> 
  filter(department == "produce") |> 
  mutate(
    organic = ifelse(str_detect(product_name, "[Oo]rganic"), 1, 0),
    organic = factor(
        case_match(
          organic,
          0 ~ "Non-Organic",
          1 ~ "Organic"
        ),
        levels = c("Non-Organic", "Organic")
      )
  ) |> 
  group_by(organic, order_dow) |> 
  summarize(
    n = n()
  ) |> 
  plot_ly(
    x = ~order_dow, y = ~n, color = ~organic,
    type = "scatter", mode = "lines+markers"
  ) |> 
  layout(
    title = "Count of Organic vs Non-Organic Produce \nOrdered by Day of Week",
    xaxis = list(title = "Day of Week"),
    yaxis = list(title = "Count of Orders")
  )
```


